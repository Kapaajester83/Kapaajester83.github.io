<!DOCTYPE html>
<html lang="en-US">

<head>
  <link rel="icon" type="image/png" sizes="48x48" href="../../../favicon.ico">
  <link rel="shortcut icon" href="../../../favicon.ico">
  <title>Hack The Box | JavaScript Deobfuscation</title>
  <meta name="author" content="Kappa">
  <meta name="description" content="Splash">
  <meta name="viewport" content="width=device-width">
  <link href='https://fonts.googleapis.com/css?family=Rock+Salt' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Orbitron:500' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Rochester' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="../../labs.css" type="text/css">
</head>

<body>

  <!--
  _  __          _____  _____        
 | |/ /    /\   |  __ \|  __ \ /\    
 | ' /    /  \  | |__) | |__) /  \   
 |  <    / /\ \ |  ___/|  ___/ /\ \  
 | . \  / ____ \| |    | |  / ____ \ 
 |_|\_\/_/    \_\_|    |_| /_/    \_\
 -->

  <div id="page">
    <div id="nav">
      <ul>
        <li><a href="https://kapaajester83.github.io/">Home</a></li>
        <li><a href="https://kapaajester83.github.io/labs/contents.html">Labs</a></li>
        <li><a href="https://duckduckgo.com/" target="_blank">DuckGo</a></li>
        <li><a href="https://github.com/Kapaajester83?tab=repositories" target="_blank">About</a></li>
        <li><a href="mailto:kappajester83@gmail.com" target="_blank">Email</a></li>
      </ul>
    </div>
    <div id="logo">
      <img src="https://kapaajester83.github.io/logo.jpeg" alt="logo">
      <h1>Kappa</h1>

      <div>
        <br>
        <br>
        <br>
        <h2>“Great things are not done by impulse, but by a series of small things brought together.”</h2>
        <br>
        <br>
      </div>
    </div>

    <div id="writeup">
      <h3>
        <a href="../../contents.html">Hack The Box</a>
      </h3>
      <hr>

      <div id="labs-table-top">

        <h4><a href="../javaScriptDeobfuscation.htm">JavaScript Deobfuscation</a></h4>
        <ul>
          <li><a href="advancedObfuscation.htm">Advanced Obfuscation</a></li>
          <li><a href="deobfuscation.htm"><b><em>~ Deobfuscation</em></b></a></li>
          <li><a href="codeAnalysis.htm">Code Analysis</a></li>
        </ul>
      </div>
      <hr>

      <div>

        <h3><em>Deobfuscation</em></h3>

        <p>Now that we understand how code obfuscation works let's start our learning towards deobfuscation. Just as there are tools to obfuscate code automatically, there are tools to beautify and deobfuscate the code automatically.</p>

        <h4>Beautify</h4>

        <p>We see that the current code we have is all written in a single line. This is known as Minified JavaScript code. In order to properly format the code, we need to Beautify our code. The most basic method for doing so is through our Browser Dev Tools.</p>

        <p>For example, if we were using Firefox, we can open the browser debugger with [ CTRL+SHIFT+Z ], and then click on our script secret.js. This will show the script in its original formatting, but we can click on the '{ }' button at the bottom, which will Pretty Print the script into its proper JavaScript formatting:
        <ul>
          <li><a href="https://academy.hackthebox.com/storage/modules/41/js_deobf_pretty_print.jpg">https://academy.hackthebox.com/storage/modules/41/js_deobf_pretty_print.jpg</a></li>
        </ul>

        <p>However, the code is still not very easy to read. This is because the code we are dealing with was not only minified but obfuscated as well. So, simply formatting or beautifying the code will not be enough. For that, we will require tools to deobfuscate the code.</p>

        <h4>Deobfuscate</h4>

        <p>We can find many good online tools to deobfuscate JavaScript code and turn it into something we can understand. One good tool is UnPacker. Let's try copying our above-obfuscated code and run it in UnPacker by clicking the UnPack button.</p>

        <p>Tip: Ensure you do not leave any empty lines before the script, as it may affect the deobfuscation process and give inaccurate results.
        <ul>
          <li><a href="https://academy.hackthebox.com/storage/modules/41/js_deobf_unpacker_1.jpg">https://academy.hackthebox.com/storage/modules/41/js_deobf_unpacker_1.jpg</a></li>
        </ul>

        <p>We can see that this tool does a much better job in deobfuscating the JavaScript code and gave us an output we can understand:</p>

        <pre>
          Code: javascript
          function generateSerial() {
            ...SNIP...
            var xhr = new XMLHttpRequest;
            var url = "/serial.php";
            xhr.open("POST", url, true);
            xhr.send(null);
          };
        </pre>

        <p>As previously mentioned, the above-used method of obfuscation is packing. Another way of unpacking such code is to find the return value at the end and use "console.log" to print it instead of executing it.</p>

        <h4>Reverse Engineering</h4>

        <p>Though these tools are doing a good job so far in clearing up the code into something we can understand, once the code becomes more obfuscated and encoded, it would become much more difficult for automated tools to clean it up. This is especially true if the code was obfuscated using a custom obfuscation tool.</p>

        <p>We would need to manually reverse engineer the code to understand how it was obfuscated and its functionality for such cases. If you are interested in knowing more about advanced JavaScript Deobfuscation and Reverse Engineering, you can check out the Secure Coding 101 module, which should thoroughly cover this topic.</p>

        <h4>Questions</h4>

        <p>Using what you learned in this section, try to deobfuscate 'secret.js' in order to get the content of the flag. What is the flag?</p>

      </div>
      <hr>

      <div id="labs-table">

        <h4><a href="../javaScriptDeobfuscation.htm">JavaScript Deobfuscation</a></h4>
        <ol>
          <li><a href="introduction.htm">Introduction</a></li>
          <li><a href="sourceCode.htm">Source Code</a></li>
          <li><a href="codeObfuscation.htm">Code Obfuscation</a></li>
          <li><a href="basicObfuscation.htm">Basic Obfuscation</a></li>
          <li><a href="advancedObfuscation.htm">Advanced Obfuscation</a></li>
          <li><a href="deobfuscation.htm"><b><em>~ Deobfuscation</em></b></a></li>
          <li><a href="codeAnalysis.htm">Code Analysis</a></li>
        </ol>
      </div>
      <hr>

    </div>
  </div>

  <div id="footer">
    <p>
      Webpage made by <a href="mailto:kappajester83@gmail.com">Kappa </a>
    </p>
  </div>

</html>